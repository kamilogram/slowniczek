<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>S≈Ç√≥wka G≈Çosowe</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 2em;
      background: #f4f4f4;
      max-width: 400px;
      margin: auto;
    }
    .card {
      background: white;
      padding: 1.5em;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      text-align: center;
    }
    .buttons {
      margin-top: 1em;
    }
    button {
      padding: 0.5em 1.2em;
      margin: 0.4em;
      font-size: 1em;
      cursor: pointer;
    }
    #restart-btn {
      display: none;
    }
    #last-word {
      font-size: 1.1em;
      color: #888;
      margin-bottom: 0.5em;
    }
  </style>
</head>
<body>
  <div class="card">
    <p id="last-word"></p>
    <p id="progress"></p>
    <h2 id="hint">≈Åadowanie...</h2>
    <p id="answer" style="visibility: hidden;"></p>
    <div class="buttons">
      <button onclick="skipWord()">Poka≈º</button>
      <button onclick="nextWord()">Wiem</button>
      <button onclick="restart()" id="restart-btn">Jeszcze raz</button>
      <button onclick="toggleListening()">üé§ G≈Çosowo</button>
    </div>
    <p style="font-size: 0.8em; color: #888;">Wypowiedz has≈Ço lub u≈ºyj przycisk√≥w üëÜ</p>
  </div>

  <script src="allWords.js"></script>
  <script>
    // teraz mo≈ºesz u≈ºywaƒá window.allWords
    let pool = [...window.allWords];
    let used = [];
    let current = null;
    let previous = null;
    let isListening = false;
    let wasSkipped = false;

    function updateProgress() {
      document.getElementById("progress").textContent = `S≈Ç√≥wko ${used.length + 1} z ${allWords.length}`;
    }

    function showWord() {
      if (pool.length === 0) {
        document.getElementById("hint").textContent = "üéâ Uko≈Ñczy≈Çe≈õ wszystkie s≈Ç√≥wka!";
        document.getElementById("answer").textContent = "";
        document.getElementById("answer").style.visibility = "hidden";
        document.getElementById("progress").textContent = "";
        document.getElementById("last-word").textContent = "";
        document.getElementById("restart-btn").style.display = "inline-block";
        return;
      }
      const index = Math.floor(Math.random() * pool.length);
      current = pool[index];
      wasSkipped = false;
      document.getElementById("hint").textContent = current.hint;
      document.getElementById("answer").textContent = current.answer;
      document.getElementById("answer").style.visibility = "hidden";
      updateProgress();
    }

    function skipWord() {
      wasSkipped = true;
      document.getElementById("answer").style.visibility = "visible";
      document.querySelector('button[onclick="nextWord()"]').textContent = "Dalej";
    }

    function nextWord() {
      if (!wasSkipped) {
        previous = current;
        document.getElementById("last-word").textContent = `Poprzednie has≈Ço: ${previous.answer}`;
        pool = pool.filter(w => w !== current);
        used.push(current);
      } else {
        // Dodaj tƒô czƒô≈õƒá, by po "Dalej" te≈º aktualizowa≈Ço siƒô last-word
        previous = current;
        document.getElementById("last-word").textContent = `Poprzednie has≈Ço: ${previous.answer}`;
      }
      wasSkipped = false;
      // Przywr√≥ƒá tekst przycisku na "Wiem"
      document.querySelector('button[onclick="nextWord()"]').textContent = "Wiem";
      showWord();
    }

    function restart() {
      pool = [...allWords];
      used = [];
      previous = null;
      wasSkipped = false;
      document.getElementById("restart-btn").style.display = "none";
      document.getElementById("progress").textContent = "";
      document.getElementById("last-word").textContent = "";
      document.getElementById("answer").style.visibility = "hidden";
      document.querySelector('button[onclick="nextWord()"]').textContent = "Wiem";
      showWord();
      if (isListening) recognition.start(); // <-- dodaj to, je≈õli chcesz nas≈Çuch po restarcie
    }

    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = 'pl-PL';
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;

    function toggleListening() {
      if (isListening) {
        recognition.stop();
        isListening = false;
        alert("üõë Nas≈Çuchiwanie wy≈ÇƒÖczone");
      } else {
        isListening = true;
        recognition.start();
      }
    }

    recognition.onresult = event => {
      const spoken = event.results[0][0].transcript.trim().toLowerCase();
      const correct = current.answer.toLowerCase();

      if (spoken === correct) {
        alert("‚úÖ Dobrze!");
        previous = current;
        document.getElementById("last-word").textContent = `Poprzednie has≈Ço: ${previous.answer}`;
        pool = pool.filter(w => w !== current);
        used.push(current);
        wasSkipped = false;
        showWord();
      } else {
        alert(`‚ùå Niepoprawnie: "${spoken}"`);
      }

      if (isListening) recognition.start();
    };

    recognition.onerror = e => {
      alert("üé§ B≈ÇƒÖd mikrofonu: " + e.error);
      isListening = false;
    };

    let touchStartX = 0;
document.addEventListener("touchstart", e => {
  touchStartX = e.changedTouches[0].screenX;
});
document.addEventListener("touchend", e => {
  const deltaX = e.changedTouches[0].screenX - touchStartX;
  if (Math.abs(deltaX) > 50) {
    if (deltaX < 0) {
      nextWord(); // przesuniƒôcie w lewo
    } else {
      skipWord(); // przesuniƒôcie w prawo
    }
  }
});

    showWord();
  </script>
</body>
</html>
